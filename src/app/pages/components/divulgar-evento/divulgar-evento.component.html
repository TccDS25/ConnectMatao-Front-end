<app-navbar></app-navbar>
<div class="container">
  <h2 class="title">Divulgue seu evento</h2>

  <form [formGroup]="eventoForm" (ngSubmit)="onSubmit()">
    <!-- Seção para upload da imagem -->
    <div class="image-upload">
      <label for="imageInput" class="image-upload-label"
        >Selecionar Imagem</label
      >
      <input
        type="file"
        id="imageInput"
        class="image-input"
        (change)="onFileChange($event)"
        multiple
      />
    </div>

    <!-- Pré-visualização da imagem -->
    <div *ngIf="imagemPreview" class="image-preview-container">
      <img [src]="imagemPreview" alt="Pré-visualização" class="image-preview" />
    </div>

    <!-- Campos do formulário -->
    <div class="form-grid">
      <!-- Título -->
      <mat-form-field appearance="fill">
        <mat-label>Título</mat-label>
        <input matInput type="text" formControlName="titulo" maxlength="150" />
        <mat-error *ngIf="eventoForm.get('titulo')?.hasError('required')">
          O título é obrigatório.
        </mat-error>
      </mat-form-field>

      <!-- Bairro -->
      <mat-form-field appearance="fill">
        <mat-label>Bairro</mat-label>
        <input matInput type="text" formControlName="bairro" />
        <mat-error *ngIf="eventoForm.get('bairro')?.hasError('required')">
          O bairro é obrigatório.
        </mat-error>
      </mat-form-field>

      <!-- Número -->
      <mat-form-field appearance="fill">
        <mat-label>Número</mat-label>
        <input matInput type="text" formControlName="numero" />
        <mat-error *ngIf="eventoForm.get('numero')?.hasError('required')">
          O número é obrigatório.
        </mat-error>
      </mat-form-field>

      <!-- Logradouro -->
      <mat-form-field appearance="fill">
        <mat-label>Logradouro</mat-label>
        <input matInput type="text" formControlName="logradouro" />
        <mat-error *ngIf="eventoForm.get('logradouro')?.hasError('required')">
          O logradouro é obrigatório.
        </mat-error>
      </mat-form-field>

      <!-- CEP -->
      <mat-form-field appearance="fill">
        <mat-label>CEP</mat-label>
        <input
          matInput
          type="text"
          formControlName="cep"
          pattern="^\d{5}-\d{3}$"
        />
        <mat-error *ngIf="eventoForm.get('cep')?.hasError('required')">
          O CEP é obrigatório.
        </mat-error>
        <mat-error *ngIf="eventoForm.get('cep')?.hasError('pattern')">
          O formato do CEP está inválido.
        </mat-error>
      </mat-form-field>

      <!-- Descrição -->
      <div class="full-width">
        <mat-form-field appearance="fill">
          <mat-label>Descrição</mat-label>
          <textarea
            matInput
            formControlName="descricao"
            maxlength="800"
          ></textarea>
          <mat-error *ngIf="eventoForm.get('descricao')?.hasError('required')">
            A descrição é obrigatória.
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Email -->
      <div class="full-width">
        <mat-form-field appearance="fill">
          <mat-label>Email</mat-label>
          <input matInput type="email" formControlName="email" />
          <mat-error *ngIf="eventoForm.get('email')?.hasError('required')">
            O email é obrigatório.
          </mat-error>
          <mat-error *ngIf="eventoForm.get('email')?.hasError('email')">
            O formato do email está inválido.
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Categoria -->
      <mat-form-field appearance="fill">
        <mat-label>Categoria</mat-label>
        <mat-select formControlName="categoria">
          <mat-option value="" disabled>Selecione uma categoria</mat-option>
          <mat-option *ngFor="let cat of categorias" [value]="cat.id">
            {{ cat.descricao }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="eventoForm.get('categoria')?.hasError('required')">
          A categoria é obrigatória.
        </mat-error>
      </mat-form-field>

      <!-- Telefone -->
      <div class="form-group contact">
        <mat-form-field appearance="fill">
          <mat-label>Telefone</mat-label>
          <input
            matInput
            formControlName="telefone"
            placeholder="(00) 0000-0000"
            (input)="formatPhone($event, 'telefone')"
            maxlength="15"
          />
          <mat-error *ngIf="eventoForm.get('telefone')?.hasError('required')">
            O telefone é obrigatório.
          </mat-error>
          <mat-error *ngIf="eventoForm.get('telefone')?.hasError('pattern')">
            Formato inválido. Use (00) 0000-0000
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Whatsapp -->
      <div class="form-group contact">
        <mat-form-field appearance="fill">
          <mat-label>Whatsapp</mat-label>
          <input
            matInput
            formControlName="whatsapp"
            placeholder="(00) 00000-0000"
            (input)="formatPhone($event, 'whatsapp')"
            maxlength="15"
          />
          <mat-error *ngIf="eventoForm.get('whatsapp')?.hasError('required')">
            O whatsapp é obrigatório.
          </mat-error>
          <mat-error *ngIf="eventoForm.get('whatsapp')?.hasError('pattern')">
            Formato inválido. Use (00) 00000-0000
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Data do evento -->
      <div class="date-time">
        <mat-form-field appearance="fill">
          <mat-label>Data do evento</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            formControlName="data"
            [min]="minDate"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error *ngIf="eventoForm.get('data')?.hasError('required')">
            A data é obrigatória.
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Horário -->
      <div class="date-time">
        <mat-form-field appearance="fill">
          <mat-label>Horário</mat-label>
          <input
            matInput
            type="time"
            formControlName="horario"
            step="300"
            placeholder="00:00"
          />
          <mat-icon matSuffix>access_time</mat-icon>
          <mat-error *ngIf="eventoForm.get('horario')?.hasError('required')">
            O horário é obrigatório.
          </mat-error>
          <mat-error *ngIf="eventoForm.get('horario')?.hasError('pattern')">
            O formato do horário está inválido.
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Faixa Etária -->
      <div class="age-range">
        <mat-form-field appearance="fill">
          <mat-label>Faixa Etária</mat-label>
          <input matInput type="number" formControlName="faixaEtaria" />
          <mat-error
            *ngIf="eventoForm.get('faixaEtaria')?.hasError('required')"
          >
            A faixa etária é obrigatória.
          </mat-error>
          <mat-error *ngIf="eventoForm.get('faixaEtaria')?.hasError('min')">
            A faixa etária deve ser maior que 0.
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Botão de envio -->
      <div class="full-width submit-button">
        <button
        type="submit"
          mat-raised-button
          color="primary"
          [disabled]="eventoForm.invalid"
        >
          Publicar evento
        </button>
      </div>
    </div>
  </form>
</div>
